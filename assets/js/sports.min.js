var app = angular.module("sportsApp", []);
      app.controller(
        "MainController",
        function ($scope, $http, $location, $anchorScroll) {
          $scope.apiUrls = {
            eventsSeason:
              "https://www.thesportsdb.com/api/v1/json/3/eventsseason.php?id=${idLeague}&s=${season}",
            teamsByLeague:
              "https://www.thesportsdb.com/api/v1/json/3/search_all_teams.php?l=${nameLeague}",
          };

          $scope.leagues = [
            {
              name: "NFL",
              leagueName: "NFL",
              idLeague: "4391",
              season: "2023",
            },
            {
              name: "CFL",
              leagueName: "CFL",
              idLeague: "4405",
              season: "2023",
            },
            {
              name: "NCAAF",
              leagueName: "NCAA Division 1",
              idLeague: "4479",
              season: "2023",
            },

            {
              name: "NHL",
              leagueName: "NHL",
              idLeague: "4380",
              season: "2023-2024",
            },
            {
              name: "MLB",
              leagueName: "MLB",
              idLeague: "4424",
              season: "2023",
            },
            {
              name: "NBA",
              leagueName: "NBA",
              idLeague: "4387",
              season: "2023-2024",
            },
            {
              name: "Premier League",
              leagueName: "English Premier League",
              idLeague: "4328",
              season: "2023-2024",
            },
            {
              name: "BRI Liga 1",
              leagueName: "Indonesian Super League",
              idLeague: "4790",
              season: "2023-2024",
            },
          ];

          $scope.selectedLeague = $scope.leagues[0]; // Default selected league

          // Function untuk mengubah nilai intRound sesuai mapping yang diberikan
          $scope.mapIntRoundValue = function (intRound) {
            switch (intRound) {
              case "125":
                return "Quarter-Final";
              case "50":
                return "Semi-Final";
              case "160":
                return "Playoff";
              case "170":
                return "Playoff Semi-Final";
              case "180":
                return "Playoff Final";
              case "200":
                return "Final";
              case "500":
                return "Pre-Season";
              default:
                return "Week " + intRound;
            }
          };

          // Remove space & "-" pada string
          $scope.removeSpacesAndDashes = function (inputString) {
            return inputString.replace(/[\s-]/g, "");
          };
          // end code

          $scope.loadData = function () {
            var apiUrl = $scope.apiUrls.eventsSeason
              .replace("${idLeague}", $scope.selectedLeague.idLeague)
              .replace("${season}", $scope.selectedLeague.season);

            $http
              .get(apiUrl)
              .then(function (response) {
                console.log(response.data); // Tambahkan ini untuk melihat respons API
                $scope.events = response.data.events;
                $scope.loadTeamLogos(); // Load team logos after events data
              })
              .catch(function (error) {
                console.error("Error fetching data:", error);
              });
          };

          $scope.loadTeamLogos = function () {
            var teamApiUrl = $scope.apiUrls.teamsByLeague.replace(
              "${nameLeague}",
              $scope.selectedLeague.leagueName
            );

            $http
              .get(teamApiUrl)
              .then(function (response) {
                $scope.teams = response.data.teams;
                $scope.logoUrl =
                  "https://cintakuaja68.github.io/assets/img/load-img.webp";

                // Associate team logos with events based on team id
                $scope.events.forEach(function (event) {
                  var homeTeam = $scope.teams.find(function (team) {
                    return team.idTeam === event.idHomeTeam;
                  });
                  if (homeTeam) {
                    event.homeTeamLogo = homeTeam.strTeamBadge;
                    event.strStadiumHomeLocation = homeTeam.strStadiumLocation;
                    event.strTeamHomeFanart1 = homeTeam.strTeamFanart1;
                    event.strTeamHomeFanart2 = homeTeam.strTeamFanart2;
                    event.strTeamHomeFanart3 = homeTeam.strTeamFanart3;
                    event.strTeamHomeFanart4 = homeTeam.strTeamFanart4;
                    event.strStadiumHome = homeTeam.strStadium;
                    event.strTeamHomeBanner = homeTeam.strTeamBanner;
                    event.thumbEvent = homeTeam.strThumb;
                    event.jerseyHome = homeTeam.strTeamJersey;
                    event.teamShortHome = homeTeam.strTeamShort;
                    event.stadiumHome = homeTeam.strStadiumThumb;
                    event.strKeyHome = homeTeam.strKeywords;
                    event.strAltHome = homeTeam.strAlternate;
                    event.websiteHome = homeTeam.strWebsite;
                    event.fbHome = homeTeam.strFacebook;
                    event.twitterHome = homeTeam.strTwitter;
                    event.instaHome = homeTeam.strInstagram;
                    event.ytHome = homeTeam.strYoutube;
                    event.rssHome = homeTeam.strRSS;
                    event.hashTagHome = $scope.removeSpacesAndDashes(
                      event.strHomeTeam
                    );
                    event.hashtagLeague = $scope.removeSpacesAndDashes(
                      event.strLeague
                    );
                    event.hashtagSport = $scope.removeSpacesAndDashes(
                      event.strSport
                    );
                  } else {
                    event.homeTeamLogo = logoUrl;
                  }

                  var awayTeam = $scope.teams.find(function (team) {
                    return team.idTeam === event.idAwayTeam;
                  });
                  if (awayTeam) {
                    event.awayTeamLogo = awayTeam.strTeamBadge;
                    event.strStadiumAwayLocation = awayTeam.strStadiumLocation;
                    event.strTeamAwayFanart1 = awayTeam.strTeamFanart1;
                    event.strTeamAwayFanart2 = awayTeam.strTeamFanart2;
                    event.strTeamAwayFanart3 = awayTeam.strTeamFanart3;
                    event.strTeamAwayFanart4 = awayTeam.strTeamFanart4;
                    event.strStadiumAway = awayTeam.strStadium;
                    event.strTeamAwayBanner = awayTeam.strTeamBanner;
                    event.teamShortAway = awayTeam.strTeamShort;
                    event.stadiumAway = awayTeam.strStadiumThumb;
                    event.jerseyAway = awayTeam.strTeamJersey;
                    event.strKeyAway = awayTeam.strKeywords;
                    event.strAltAway = awayTeam.strAlternate;
                    event.websiteAway = awayTeam.strWebsite;
                    event.fbAway = awayTeam.strFacebook;
                    event.twitterAway = awayTeam.strTwitter;
                    event.instaAway = awayTeam.strInstagram;
                    event.ytAway = awayTeam.strYoutube;
                    event.rssAway = awayTeam.strRSS;
                    event.hashTagAway = $scope.removeSpacesAndDashes(
                      event.strAwayTeam
                    );
                  } else {
                    event.awayTeamLogo = logoUrl;
                  }
                });
              })

              .catch(function (error) {
                console.error("Error fetching team data:", error);
              });
          };

          $scope.getRelevantEvents = function () {
            const today = new Date();
            const relevantEvents = {
              todayEvents: [],
              nextEvents: [],
            };

            $scope.events.forEach(function (event) {
              const eventDate = new Date(event.dateEvent);

              if (eventDate.toDateString() === today.toDateString()) {
                relevantEvents.todayEvents.push(event);
              } else if (eventDate > today) {
                relevantEvents.nextEvents.push(event);
              }
            });

            return relevantEvents;
          };

          // Load data directly based on selected league
          $scope.$watch("selectedLeague", function () {
            $scope.loadData();
          });

          // Fungsi untuk ekstraksi kata dari nama tim
          function extractWords(teamName, wordCount) {
            const words = teamName.split(" ");
            const extractedWords = words.slice(0, wordCount).join(" ");
            return extractedWords;
          }

          // Fungsi untuk ekstraksi kata terakhir dari nama tim
          function extractLastWord(teamName) {
            const words = teamName.split(" ");
            const lastWord = words[words.length - 1];
            return lastWord;
          }

          // Fungsi untuk ekstraksi singkatan dari nama tim
          function extractTeamAbbreviation(teamName) {
            const words = teamName.split(" ");

            if (words.length === 1) {
              const firstWord = words[0];
              if (firstWord.length <= 4) {
                return firstWord; // Ambil kata pertama jika panjangnya <= 4
              }
              return firstWord.substring(0, 3); // Ambil 3 huruf pertama jika 1 kata
            } else if (words.length >= 2) {
              const firstLetters = words.map((word) => word.charAt(0)).join("");
              return firstLetters; // Ambil huruf pertama dari setiap kata
            }

            return ""; // Kembalikan string kosong jika tidak ada kata
          }

          // Kamus yang memetakan idLeague ke data selLeagueAlt yang sesuai
          var leagueAltMap = {
            4328: {
              idLeague: "4328",
              strLeagueAlt: "EPL",
            },
            4790: {
              idLeague: "4790",
              strLeagueAlt: "BRI Liga 1",
            },
            4331: {
              idLeague: "4331",
              strLeagueAlt: "Fußball-Bundesliga",
            },
            4332: {
              idLeague: "4332",
              strLeagueAlt: "Serie A",
            },
            4335: {
              idLeague: "4335",
              strLeagueAlt: "La Liga",
            },
            4346: {
              idLeague: "4346",
              strLeagueAlt: "MLS",
            },
            4337: {
              idLeague: "4337",
              strLeagueAlt: "Eredivisie",
            },
            4480: {
              idLeague: "4480",
              strLeagueAlt: "UCL",
            },
            4380: {
              idLeague: "4380",
              strLeagueAlt: "National Hockey League",
            },
            // Tambahkan entri lain sesuai kebutuhan
          };

          var tvChannelsMap = {
            4328: {
              //Premier
              idLeague: "4328",
              Tv: "BT Sport,",
              Tv2: "Sky Sports,",
              Tv3: "NBC Sports,",
              Tv4: "FuboTV,",
              Tv5: "Optus,",
              Tv6: "FuboTV,",
            },
            4346: {
              // MLS
              idLeague: "4346",
              Tv: " Apple TV,",
              Tv2: "ESPN,",
              Tv3: "Fox Sports,",
              Tv4: "Univision,",
            },
            4335: {
              // La Liga
              idLeague: "4335",
              Tv: "ESPN,",
            },
            4331: {
              // Bundesliga
              idLeague: "4328",
              Tv: "ESPN,",
            },
            4790: {
              //BRI Liga 1
              idLeague: "4790",
              Tv: "Indosiar,",
            },
            4332: {
              //Serie A
              idLeague: "4332",
              Tv: "CBS Sports,",
            },
            4334: {
              //Ligue-1
              idLeague: "4334",
              Tv: "Amazon Prime Video,",
            },
            4391: {
              //NFL
              idLeague: "4391",
              Tv: "CBS Sports,",
              Tv2: "Fox Sports,",
              Tv3: "ESPN,",
              Tv4: "NBC Sports,",
            },
            4405: {
              //CFL
              idLeague: "4405",
              Tv: "CBS Sports,",
            },
            4479: {
              // NCAAF
              idLeague: "4479",
              Tv: "CBS Sports,",
              Tv2: "Fox Sports,",
              Tv3: "ESPN,",
              Tv4: "NBC Sports,",
            },
            5063: {
              // European League of Football
              idLeague: "5063",
              Tv: "ran.de,",
              Tv2: "Pro7Maxx,",
              Tv3: "MoreThanSportsTV,",
            },

            4380: {
              // NHL
              idLeague: "4380",
              Tv: "ESPN,",
              Tv2: "Turner Sports,",
            },
            4424: {
              // MLB
              idLeague: "4424",
              Tv: "MLB Network,",
              Tv2: "Fox Sports,",
              Tv3: "ESPN,",
              Tv4: "Turner Sports,",
            },
            4387: {
              // NBA
              idLeague: "4387",
              Tv: "ESPN,",
              Tv2: "Turner Sports,",
            },
            // Tambahkan entri lain sesuai kebutuhan
          };

          $scope.showEventDetails = function (event) {
            $scope.selectedEvent = event;

            // Ekstraksi dan pemformatan nama tim
            const homeTeamName = event.strHomeTeam;
            const awayTeamName = event.strAwayTeam;

            // Mengambil data selLeagueAlt sesuai idLeague
            $scope.selLeagueAlt = leagueAltMap[event.idLeague] || null;
            // Mengambil data tvChannels sesuai idLeague
            $scope.tvChannels = tvChannelsMap[event.idLeague] || null;

            // Ambil satu kata jika ada 2 kata, atau ambil 2 kata jika ada 3 kata
            const extractedHomeTeamNameWords = extractWords(
              homeTeamName,
              homeTeamName.split(" ").length === 2 ? 1 : 2
            );
            const extractedAwayTeamNameWords = extractWords(
              awayTeamName,
              awayTeamName.split(" ").length === 2 ? 1 : 2
            );

            // Ambil kata terakhir
            const extractedHomeTeamNameLast = extractLastWord(homeTeamName);
            const extractedAwayTeamNameLast = extractLastWord(awayTeamName);

            // Ekstraksi singkatan dari nama tim
            const formHomeShort = extractTeamAbbreviation(homeTeamName);
            const formAwayShort = extractTeamAbbreviation(awayTeamName);

            // Format tim names sesuai keinginan Anda
            $scope.formattedTeamNamesWords = `${extractedHomeTeamNameWords} vs ${extractedAwayTeamNameWords}`;
            $scope.formattedTeamNamesLast = `${extractedHomeTeamNameLast} vs ${extractedAwayTeamNameLast}`;
            $scope.formattedTeamHomeNamesWords = extractedHomeTeamNameWords;
            $scope.formattedTeamAwayNamesWords = extractedAwayTeamNameWords;
            $scope.formattedTeamHomeNamesLast = extractedHomeTeamNameLast;
            $scope.formattedTeamAwayNamesLast = extractedAwayTeamNameLast;
            $scope.formHomeShort = formHomeShort;
            $scope.formAwayShort = formAwayShort;
          };

          // sosialmedia
          $scope.getDataField = function (
            dataArray,
            fieldName,
            filterKey,
            filterValue
          ) {
            if (!dataArray || !fieldName) {
              return "";
            }

            var filteredData = dataArray.filter(function (item) {
              return item[filterKey] === filterValue;
            });

            if (filteredData.length > 0) {
              return filteredData[0][fieldName];
            }

            return "";
          };

          // copy text
          $scope.copyTextContent = async function (elementId) {
            var contentElement = document.getElementById(elementId);
            var textToCopy = contentElement.innerText;

            try {
              await navigator.clipboard.writeText(textToCopy);
              alert("Teks berhasil disalin!");
            } catch (error) {
              console.error("Terjadi kesalahan saat menyalin teks:", error);
            }
          };

          // scroll to down //
          $scope.scrollToDescriptIs = function () {
            console.log("Scroll function called");
            $location.hash("descriptIs");
            $anchorScroll();
          };

          // scroll to top //
          $scope.scrollToUpcomingEvent = function () {
            console.log("Scroll function called");
            $location.hash("upcomingEvent");
            $anchorScroll();
          };

          // clear data menu liga
          $scope.clearSelectedEvent = function () {
            $scope.selectedEvent = null;
            // Reset showMore and visibleEventsCount
            $scope.showMore = false;
            $scope.visibleEventsCount = 6;
          };

          // show more & less more
          $scope.showMore = false; // Initial state
          $scope.visibleEventsCount = 6; // Initial number of visible events

          $scope.toggleEventsDisplay = function () {
            $scope.showMore = !$scope.showMore;

            if ($scope.showMore) {
              $scope.visibleEventsCount =
                $scope.getRelevantEvents().nextEvents.length;
            } else {
              $scope.visibleEventsCount = 6;
            }
          };
          // Fungsi untuk mengubah waktu UTC menjadi waktu lokal dalam format 24 jam
          $scope.getLocalTime = function (date, time) {
            const utcDateTime = new Date(date + " " + time + " UTC");
            const localTime = utcDateTime.toLocaleTimeString([], {
              hour: "2-digit",
              minute: "2-digit",
              hour12: false,
            });

            // Ubah 24:00 menjadi 00:00 jika jam 12 malam
            const formattedTime = localTime === "24:00" ? "00:00" : localTime;

            return formattedTime;
          };
          // Conversi tanggal
          function formatDate(inputDate) {
            const months = [
              "Januari",
              "Februari",
              "Maret",
              "April",
              "Mei",
              "Juni",
              "Juli",
              "Agustus",
              "September",
              "Oktober",
              "November",
              "Desember",
            ];

            const days = [
              "Minggu",
              "Senin",
              "Selasa",
              "Rabu",
              "Kamis",
              "Jumat",
              "Sabtu",
            ];

            const date = new Date(inputDate);
            const dayName = days[date.getDay()];
            const day = date.getDate();
            const monthName = months[date.getMonth()];
            const year = date.getFullYear();

            return `${dayName}, ${day} ${monthName} ${year}`;
          }

          // Contoh penggunaan:
          const formattedDate = formatDate("2023-08-20"); // Ganti dengan tanggal yang sesuai
          console.log(formattedDate);
        }
      );